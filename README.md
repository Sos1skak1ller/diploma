# Satellite Image Analyzer

Система анализа спутниковых радиолокационных (SAR) снимков с графическим интерфейсом и алгоритмами детекции/улучшения изображений.

## Описание проекта

Проект представляет собой комплексную систему для обработки и анализа спутниковых радиолокационных снимков, включающую:

- **Улучшение качества SAR изображений** - специализированные алгоритмы шумоподавления, осветления и повышения контраста для темных радиолокационных снимков
- **Детекция объектов** - автоматическое обнаружение объектов на снимках с использованием YOLO и GATE алгоритмов
- **Классификация сцен** - классификация объектов на SAR снимках с помощью предобученной модели SAR-HUB ResNet-18 TSX
- **Графический интерфейс** - удобный GUI на PyQt5 для работы с изображениями

### Основные возможности

- Множество алгоритмов улучшения SAR изображений (гибридное подавление шума, адаптивное подавление спекла, анизотропная диффузия)
- Автоматическое выделение зон интересов (ROI) на SAR снимках
- Классификация объектов с помощью SAR-HUB ResNet-18 TSX (32 класса)
- Полный пайплайн: улучшение → выделение ROI → классификация
- Метрики качества улучшения (PSNR, контраст, яркость)
- Интерактивный просмотр результатов классификации

## Быстрый старт

### Требования

- Python >= 3.9
- pip

### Установка

1. **Клонируйте репозиторий** (если необходимо):
```bash
git clone <repository-url>
cd diploma
```

2. **Создайте виртуальное окружение:**
```bash
python3 -m venv .venv
```

3. **Активируйте виртуальное окружение:**

   **На macOS/Linux:**
   ```bash
   source .venv/bin/activate
   ```

   **На Windows:**
   ```bash
   .venv\Scripts\activate
   ```

4. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

### Подготовка моделей

Перед запуском приложения необходимо разместить файл весов модели SAR-HUB:

- Поместите файл `ResNet18_TSX.pth` в папку `models/`
- Опционально: создайте файл `models/tsx_labels.txt` с названиями 32 классов (по одному на строку)

## Запуск приложения

### Через Makefile (рекомендуется)

```bash
# Создать виртуальное окружение
make venv

# Активировать окружение
source .venv/bin/activate  # macOS/Linux
# или
.venv\Scripts\activate     # Windows

# Установить зависимости
make install

# Запустить основное GUI приложение
make run

# Запустить демо-интерфейс
make demo

# Запустить тесты
make test

# Очистить временные файлы
make clean
```

### Напрямую через Python

**Основной интерфейс:**
```bash
python -m main.interface.run_interface
```

**Демо-интерфейс:**
```bash
python -m main.interface.demo_interface
```

## Структура проекта

```
diploma/
├── main/                           # Основной пакет проекта
│   ├── algorythms/                 # Алгоритмы обработки
│   │   ├── area_selection/         # Детекция объектов (YOLO, GATE)
│   │   │   ├── sar_gate_yolo/      # SAR детекция
│   │   │   └── sar_hub_resnet18_inference.py  # Классификация SAR-HUB
│   │   └── improvment/             # Улучшение изображений
│   │       └── image_enhancement.py # Алгоритмы улучшения SAR
│   ├── interface/                  # Графический интерфейс
│   │   ├── run_interface.py        # Точка входа приложения
│   │   ├── main_interface.py       # GUI компоненты
│   │   ├── new_controller.py       # Контроллер логики
│   │   └── view.py                  # Компоненты отображения
│   └── tests/                      # Тесты
├── models/                         # Модели машинного обучения
│   ├── ResNet18_TSX.pth           # Веса SAR-HUB ResNet-18 TSX
│   └── tsx_labels.txt              # Названия классов (опционально)
├── images/                         # Примеры изображений
│   └── enhanced/                   # Обработанные изображения
├── tmp/                            # Временные файлы
├── requirements.txt                # Зависимости проекта
├── Makefile                        # Команды для сборки/запуска
└── README.md                       # Этот файл
```

## Использование приложения

### Полный пайплайн обработки SAR снимков

1. **Загрузите изображение** через вкладку "Главная - Детекция объектов"
2. Перейдите на вкладку **"Улучшение качества снимков"**
3. Выберите тип улучшения и интенсивность
4. Нажмите **"Полный SAR пайплайн"**

Пайплайн выполнит:
- Улучшение качества всего изображения
- Автоматическое выделение зон интересов (ROI)
- Классификацию каждой зоны с помощью SAR-HUB ResNet-18 TSX
- Отображение результатов в таблице "Найденные объекты"

### Просмотр результатов

- **Оригинальное изображение** - показывает полный снимок с выделенными зонами и подписями классов
- **Предсказание модели** - показывает отдельные фрагменты зон с подписями классов
- **Найденные объекты** - таблица с результатами классификации для каждой зоны
- Используйте стрелки **← / →** для навигации по зонам

### Улучшение отдельных фрагментов

После выполнения полного пайплайна можно улучшить качество текущего отображаемого фрагмента:
1. Выберите метод улучшения и интенсивность на главной вкладке
2. Нажмите **"Улучшить текущий фрагмент"**

## Алгоритмы улучшения SAR изображений

- **Гибридное подавление шума SAR** - комбинация bilateral фильтра и NLM (Non-local Means)
- **Адаптивное подавление спекла SAR** - адаптивный фильтр в духе Lee/Frost
- **Анизотропная диффузия SAR** - анизотропная диффузия (Perona-Malik / SRAD)

## Тестирование

Запустить все тесты:
```bash
make test
```

Или отдельные тесты:
```bash
python -m main.tests.test_enhancement
python -m main.tests.test_interface
python -m main.tests.test_sar_enhancement
```

## Примеры использования

### Программный интерфейс

```python
from main.algorythms.improvment.image_enhancement import ImageEnhancement

# Создаем объект для улучшения изображений
enhancer = ImageEnhancement()

# Улучшаем изображение
enhanced_img, metrics = enhancer.enhance_image(
    image_path="images/1.jpg",
    method="hybrid_sar_denoise",
    intensity=70
)

# Сохраняем результат
enhancer.save_enhanced_image(enhanced_img, "images/enhanced/output.jpg")

# Выводим метрики
print(f"PSNR: {metrics['psnr']}")
print(f"Улучшение контраста: {metrics['contrast_improvement']}%")
print(f"Изменение яркости: {metrics['brightness_change']}%")
```

### Классификация с помощью SAR-HUB

```python
from pathlib import Path
from main.algorythms.area_selection.sar_hub_resnet18_inference import classify_image

# Классификация изображения
result = classify_image(
    image_path=Path("images/1.jpg"),
    weights_path=Path("models/ResNet18_TSX.pth"),
    labels_path=Path("models/tsx_labels.txt"),  # опционально
    topk=5
)

# Вывод результатов
for pred in result["predictions"]:
    print(f"{pred['rank']}. {pred['label']}: {pred['prob']:.4f}")
```

## Разработка

### Добавление новых зависимостей

1. Добавьте пакет в `requirements.txt`
2. Установите зависимости:
```bash
pip install -r requirements.txt
```

### Обновление зависимостей

```bash
pip install --upgrade -r requirements.txt
```

### Очистка проекта

```bash
make clean
```

Это удалит:
- Временные файлы из `tmp/`
- Все `__pycache__` директории
- Скомпилированные `.pyc` файлы

## Известные проблемы и решения

**Проблема:** Ошибки импорта модулей
```bash
# Решение: Убедитесь, что вы в корневой директории проекта и виртуальное окружение активировано
cd /path/to/diploma
source .venv/bin/activate
python -m main.interface.run_interface
```

**Проблема:** Модель SAR-HUB не найдена
```bash
# Решение: Убедитесь, что файл ResNet18_TSX.pth находится в папке models/
ls models/ResNet18_TSX.pth
```

**Проблема:** Недостаточно памяти для больших изображений
```bash
# Решение: Система автоматически обрабатывает изображения по частям
# Можно уменьшить размер обрабатываемых блоков в коде
```

## Лицензия

Дипломный проект

## Авторы

Diplom Project Team

## Дополнительная информация

- [PyQt5 Documentation](https://www.riverbankcomputing.com/static/Docs/PyQt5/)
- [OpenCV Documentation](https://docs.opencv.org/)
- [PyTorch Documentation](https://pytorch.org/docs/)
- [SAR-HUB Repository](https://github.com/XAI4SAR/SAR-HUB)

---

**Версия:** 2.0.0  
**Последнее обновление:** 2025
